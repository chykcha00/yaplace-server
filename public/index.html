<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>üé® Yaplace Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0, viewport-fit=cover">

    <link rel="stylesheet" href="style.css">

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º SDK –Ø–Ω–¥–µ–∫—Å.–ò–≥—Ä –õ–û–ö–ê–õ–¨–ù–û -->
    <script src="/sdk.js"></script>

    <!-- –°—Ç–∏–ª—å –∑–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ -->
    <style>
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            z-index: 999999;
        }
    </style>

    <script>
        let ysdk = null;
        let userLang = "ru";

        document.addEventListener("DOMContentLoaded", () => {
            if (typeof YaGames === "undefined") {
                console.error("‚ùå SDK –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü—Ä–æ–≤–µ—Ä—å, —á—Ç–æ —Ñ–∞–π–ª sdk.js –ª–µ–∂–∏—Ç —Ä—è–¥–æ–º —Å index.html");
                window.ysdk = null;
                window.userLang = userLang;
                // –£–±–∏—Ä–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É, –µ—Å–ª–∏ SDK –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
                document.getElementById('loading-screen')?.remove();
                return;
            }

            YaGames.init()
                .then(sdk => {
                    ysdk = sdk;
                    window.ysdk = sdk;
                    userLang = sdk.environment?.i18n?.lang || "ru";
                    window.userLang = userLang;
                    console.log("‚úÖ Yandex SDK –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω, —è–∑—ã–∫:", userLang);

                    // üî• –û–°–¢–ê–í–õ–Ø–ï–ú –í–´–ó–û–í GAMEREADY –¢–ê–ú –ñ–ï, –ì–î–ï –û–ù –ë–´–õ
                    if (sdk.features?.LoadingAPI?.ready) {
                        sdk.features.LoadingAPI.ready();
                        console.log("‚úÖ LoadingAPI.ready() –≤—ã–∑–≤–∞–Ω");
                    }

                    // ‚úÖ –£–ë–ò–†–ê–ï–ú –ó–ê–ì–†–£–ó–û–ß–ù–´–ô –≠–ö–†–ê–ù ‚Äî –ë–û–õ–¨–®–ï –ù–ò–ß–ï–ì–û –ù–ï –ú–ï–ù–Ø–ï–ú
                    document.getElementById('loading-screen')?.remove();

                    if (ysdk.adv) {
                        console.log("üé¨ –ú–æ–¥—É–ª—å —Ä–µ–∫–ª–∞–º—ã –≥–æ—Ç–æ–≤");
                    } else {
                        console.warn("‚ö†Ô∏è –ú–æ–¥—É–ª—å —Ä–µ–∫–ª–∞–º—ã –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω");
                    }

                    const adButton = document.getElementById("watch-ad");
                    if (adButton) {
                        adButton.addEventListener("click", () => {
                            if (ysdk.adv) {
                                ysdk.adv.showRewardedVideo({
                                    callbacks: {
                                        onOpen: () => console.log("‚ñ∂Ô∏è –†–µ–∫–ª–∞–º–∞ –∑–∞–ø—É—â–µ–Ω–∞"),
                                        onRewarded: () => {
                                            console.log("üéÅ –ò–≥—Ä–æ–∫ –ø–æ–ª—É—á–∏–ª –Ω–∞–≥—Ä–∞–¥—É");
                                            if (window.updatePixels) window.updatePixels(5);
                                        },
                                        onClose: () => console.log("‚èπ –†–µ–∫–ª–∞–º–∞ –∑–∞–∫—Ä—ã—Ç–∞"),
                                        onError: (err) => console.warn("‚ö†Ô∏è –û—à–∏–±–∫–∞ —Ä–µ–∫–ª–∞–º—ã:", err)
                                    }
                                });
                            }
                        });
                    }
                })
                .catch(err => {
                    console.warn("‚ö†Ô∏è –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Yandex SDK:", err);
                    window.ysdk = null;
                    window.userLang = userLang;
                    document.getElementById('loading-screen')?.remove();
                });
        });
    </script>
</head>
<body>
    <!-- ‚úÖ –ó–ê–ì–†–£–ó–û–ß–ù–´–ô –≠–ö–†–ê–ù (–Ω–æ–≤–æ–µ) -->
    <div id="loading-screen">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

    <!-- –û–°–¢–ê–õ–¨–ù–û–ô –ö–û–ù–¢–ï–ù–¢ ‚Äî –ö–ê–ö –ë–´–õ -->
    <div id="main-menu">
        <div class="menu-box">
            <h1>üé® Yaplace</h1>
            <p>–û–Ω–ª–∞–π–Ω –ø–æ–ª–æ—Ç–Ω–æ, –≥–¥–µ –∫–∞–∂–¥—ã–π –∏–≥—Ä–æ–∫ –º–æ–∂–µ—Ç —Å—Ç–∞–≤–∏—Ç—å –ø–∏–∫—Å–µ–ª–∏</p>
            <input type="text" id="player-name" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è">
            <button id="start-game">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
        </div>
    </div>

    <div id="toast" class="toast hidden">
        <p id="toast-message"></p>
    </div>

    <div id="header">
        <h1>Yaplace</h1>
        <div id="pixel-counter">
            –ü–∏–∫—Å–µ–ª–∏: <span id="pixels">100</span>
            <button id="collect-pixels">+10</button>
            <button id="watch-ad">üéÅ +5 –∑–∞ —Ä–µ–∫–ª–∞–º—É</button>
            <span id="collect-timer"></span>
        </div>
        <button id="open-gallery">üêâ –†–∏—Å—É–Ω–∫–∏ –Ω–µ–¥–µ–ª–∏</button>
    </div>

    <div id="container">
        <canvas id="board"></canvas>
        <div id="sidebar">
            <h2>–ß–∞—Ç</h2>
            <div id="chat-container">
                <div id="chat-global" class="chat-box"></div>
                <div id="chat-controls">
                    <input type="text" id="chat-input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ">
                    <button id="send-chat">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                </div>
            </div>
        </div>
    </div>

    <div id="footer">
        <div id="palette"></div>
        <button id="reset-view">–°–±—Ä–æ—Å –≤–∏–¥–∞</button>
    </div>

    <div id="gallery-modal" class="hidden">
        <div class="gallery-content">
            <button id="close-gallery">‚ùå</button>
            <h2>üñº –†–∏—Å—É–Ω–∫–∏ –Ω–µ–¥–µ–ª–∏</h2>
            <div id="gallery"></div>
        </div>
    </div>

    <script src="main.js" defer></script>
</body>
</html>